---
title: "RvAC | Randomization and virtual Allocation Concealment"
---

```{css, echo = FALSE}
body {
  font-size: 2em;
}

div.main-container {
  max-width: 1280px;
  margin-left: auto;
  margin-right: auto;
}
```

## {.tabset}

<br>

### **ClinicalTrials.gov**

<br>

<iframe src="https://clinicaltrials.gov/ct2/show/NCT05480982" style="width:100%; height:600px;"></iframe>

<br>

*Fontes:* [**ClinicalTrials.gov**](https://clinicaltrials.gov)

<br>

### **Randomization**

<br>

#### *Generate list*

```{r rand-alloc, echo = TRUE, include = TRUE, comment = NA, warning = FALSE, message = FALSE, fig.align = 'center', out.width = "100%"}
# load packages
library("blockrand", character.only = TRUE)
library("png", character.only = TRUE)
library("writexl", character.only = TRUE)

# reproducible results
seed <- 2020
set.seed(seed)

# sample size
N <- 200

# groups
grupos <- c("CFT", "PLT")
K = length(grupos)

# blocks
B <- 10 / K

# randomize
lista <- blockrand(
  N,
  num.levels = K,
  # treatments
  levels = grupos,
  # treatment names
  block.sizes = seq(1:B)
)
lista <- as.data.frame(lista)

# save list im disk
write_xlsx(lista, "lista_alocacao.xlsx")
```

<br>

#### *Generate folders*

```{r rand-alloc-hide, echo = TRUE, include = TRUE, comment = NA, warning = FALSE, message = FALSE, fig.align = 'center', out.width = "100%"}
# cria as pastas numeradas de acordo com o N
for (i in 1:dim(lista)[1]) {
  dir.name <- formatC(lista$id[i], width = 3, flag = "0")
  dir.create(file.path("ids"))
  dir.create(file.path("ids", dir.name))
  par(mai = c(0.1, 0.1, 0.1, 0.1))
  par(oma = c(1, 1, 1, 1))
  par(pty = "s")
  par(width = 4, height = 4, unit = "in")
  png(file = file.path("ids", dir.name, paste0(dir.name, ".png")), bg = "transparent")
  plot(
    NULL,
    xlim = c(-1, 1),
    ylim = c(-1, 1),
    ylab = NA,
    xlab = NA,
    bty = "n",
    axes = FALSE,
    frame.plot = TRUE,
    asp = 1
  )
  text(x = 0,
       y = 0,
       labels = lista$treatment[i],
       cex = 10
       )
  title(paste0('Participant ID ', dir.name), cex.main = 4)
  dev.off()
}
```

### **Allocation concealment**

<br>

```{r rand-alloc-show, , echo = FALSE, include = TRUE, comment = NA, warning = FALSE, message = FALSE, fig.align = 'center', out.width = "100%", results = "asis"}
# carrega os pacotes
library("fontawesome", character.only = TRUE)

# exibe a lista em formato de hyperlink
for (i in 1:dim(lista)[1]) {
  dir.name <- formatC(lista$id[i], width = 3, flag = "0")
  
  cat('<a style=\"margin:auto;\" href=\"',
      file.path("ids", dir.name, paste0(dir.name, ".png")),
      '\" target="_blank" rel=\"noopener\" onclick=\"return confirm(\'Are you sure?\')\">',
      fa("user", height = "2em", width = "2em", margin_right = "0.2em"),
      'Participant ID ', dir.name,
      '</a>',
      sep = "")
  
  cat('\n\n')
  cat('\n\n')
}
```

